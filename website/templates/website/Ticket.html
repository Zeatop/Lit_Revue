{% extends 'website/base.html' %}
{% block content %}
<div class="container mt-5">
    {% if view.action == 'delete' %}
        <h2>Confirmer la suppression du ticket</h2>
        <p>Êtes-vous sûr de vouloir supprimer le ticket "{{ ticket.book }}" ?</p>
        <form method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Confirmer la suppression</button>
            <a href="{% url 'website:ticket_detail' ticket.pk %}" class="btn btn-secondary">Annuler</a>
        </form>
    {% elif view.action == 'detail' %}
        <h2>Détails du ticket</h2>
        <p><strong>Livre:</strong> {{ ticket.book }}</p>
        <p><strong>Description:</strong> {{ ticket.description }}</p>
        <p><strong>Créé par:</strong> {{ ticket.user }}</p>
        <p><strong>Date de création:</strong> {{ ticket.time_created }}</p>
        {% if ticket.image %}
            <img src="{{ ticket.image.url }}" alt="{{ ticket.book }}" class="img-fluid">
        {% endif %}
        <div class="mt-3">
            <a href="{% url 'website:edit_ticket' ticket.pk %}" class="btn btn-primary">Modifier</a>
            <a href="{% url 'website:delete_ticket' ticket.pk %}" class="btn btn-danger">Supprimer</a>
            {% if not ticket.review_set.exists %}
                <a href="{% url 'website:create_review_for_ticket' ticket.pk %}" class="btn btn-success">Répondre</a>
            {% endif %}
        </div>
    {% else %}
        <h2>
            {% if view.action == 'create' %}
                Créer un nouveau ticket
            {% elif view.action == 'edit' %}
                Modifier le ticket
            {% endif %}
        </h2>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">
                {% if view.action == 'create' %}Créer{% else %}Modifier{% endif %}
            </button>
            <a href="{% url 'website:ticket_list' %}" class="btn btn-secondary">Annuler</a>
        </form>
    {% endif %}
</div>
{% endblock %}